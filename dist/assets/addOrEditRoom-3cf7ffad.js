import{a as Ie,e as ye,f as ve,n as ge,o as be,p as _e,q as Le,b as Ve,c as Ce,m as he,r as ke}from"./index-87660c7d.js";import{_ as we}from"./uploadImg.vue_vue_type_script_setup_true_lang-09a00989.js";import{d as Re,f as Te,x as Ee,r as _,S as $,w as xe,K as Ue,a as f,o as i,h as I,i as s,l as h,t as k,e as r,c as v,B as g,F as b,O as y,b as w,n as He,z as M,_ as qe}from"./index-f83309f8.js";import{d as V,g as P,e as F,B as z}from"./constEnums-c94e3170.js";import"./index-2a3f9cb3.js";const Ne={class:"card-header"},Oe={class:"flex-center"},Be={class:"flex-center m-t-20"},De=Re({__name:"addOrEditRoom",setup(Ae){const T=Te(),E=Ee(),x=_(),o=_({id:"",roomNumber:"",rent:0,apartmentId:"",isRelease:V.NOT_RELEASED,attrValueIds:[],facilityInfoIds:[],labelInfoIds:[],paymentTypeIds:[],leaseTermIds:[],graphVoList:[]}),K=$({roomNumber:[{required:!0,message:"请输入房间号",trigger:"blur"}],rent:[{required:!0,message:"请输入租金",trigger:"blur"}],apartmentId:[{required:!0,message:"请选择公寓",trigger:"change"}],attrValueIds:[{required:!0,message:"请选择属性",trigger:"change"}],facilityInfoIds:[{required:!0,message:"请选择配套",trigger:"change"}],labelInfoIds:[{required:!0,message:"请选择标签",trigger:"change"}],paymentTypeIds:[{required:!0,message:"请选择支付方式",trigger:"change"}],leaseTermIds:[{required:!0,message:"请选择可选租期",trigger:"change"}],graphVoList:[{required:!0,message:"请上传图片",trigger:"change"}]}),l=$({provinceList:[],provinceId:"",cityList:[],cityId:"",districtList:[],districtId:"",apartmentList:[],apartmentId:""});xe(()=>l,t=>{o.value.apartmentId=t.apartmentId},{immediate:!0,deep:!0});async function j(){try{const{data:t}=await Ie();l.provinceList=t}catch(t){console.log(t)}}async function U(t=l.provinceId){try{const{data:a}=await Ve(t);l.cityList=a}catch(a){console.log(a)}}async function H(t=l.cityId){try{const{data:a}=await Ce(t);l.districtList=a}catch(a){console.log(a)}}async function q(t=l.districtId){try{const{data:a}=await he(t);l.apartmentList=a}catch(a){console.log(a)}}function N(){l.cityId="",l.cityList=[]}function C(){l.districtId="",l.districtList=[]}function L(){l.apartmentId="",l.apartmentList=[]}const G=async()=>{let t=l.provinceId;t&&(N(),C(),L(),await U(t))},J=()=>{l.provinceId="",N(),C(),L()},Q=async()=>{let t=l.cityId;t&&(C(),L(),await H(t))},W=()=>{console.log("清空城市"),l.cityId="",C(),L()},X=async()=>{let t=l.districtId;t&&(L(),await q(t))},Y=()=>{console.log("清空区域"),l.districtId="",L()},Z=async()=>{console.log("公寓改变")},ee=()=>{console.log("清空公寓"),l.apartmentId=""},O=_([]),B=_([]),R=_([]),D=_([]),A=_([]);async function ae(){try{const{data:t}=await ye(z.ROOM);O.value=t}catch(t){console.log(t)}}async function te(){try{const{data:t}=await ve(z.ROOM);B.value=t}catch(t){console.log(t)}}async function le(){try{const{data:t}=await ge();R.value=t.map(a=>({value:a.id+a.name,label:a.name,children:a.attrValueList.map(u=>({value:u.id,label:`${u.name}(${a.name})`,parentId:a.id+a.name}))}))}catch(t){console.log(t)}}async function ne(){try{const{data:t}=await be();D.value=t}catch(t){console.log(t)}}async function oe(){try{const{data:t}=await _e();A.value=t}catch(t){console.log(t)}}function re(t){var a,u;if(t.parentId){const d=(u=(a=R.value.find(c=>c.value===t.parentId))==null?void 0:a.children)==null?void 0:u.map(c=>c.value);He(()=>{var c,p;o.value.attrValueIds=(c=o.value.attrValueIds)==null?void 0:c.filter(n=>!(d!=null&&d.includes(n))),(p=o.value.attrValueIds)==null||p.push(t.value)})}}function se(t,a,u){o.value.graphVoList=u==null?void 0:u.map(d=>{var c;return{...d,url:((c=d==null?void 0:d.response)==null?void 0:c.data)||d.url}})}async function de(t){var a,u,d,c,p;try{const{data:n}=await Le(t);o.value=n,o.value.attrValueIds=((a=n.attrValueVoList)==null?void 0:a.map(m=>m.id))||[],delete n.attrValueVoList,o.value.facilityInfoIds=((u=n.facilityInfoList)==null?void 0:u.map(m=>m.id))||[],delete n.facilityInfoList,o.value.labelInfoIds=((d=n.labelInfoList)==null?void 0:d.map(m=>m.id))||[],delete n.labelInfoList,o.value.paymentTypeIds=((c=n.paymentTypeList)==null?void 0:c.map(m=>m.id))||[],delete n.paymentTypeList,o.value.leaseTermIds=((p=n.leaseTermList)==null?void 0:p.map(m=>m.id))||[],delete n.leaseTermList,l.provinceId=n.apartmentInfo.provinceId,l.cityId=n.apartmentInfo.cityId,l.districtId=n.apartmentInfo.districtId,l.apartmentId=n.apartmentId,n.apartmentInfo.provinceId&&U(n.apartmentInfo.provinceId),n.apartmentInfo.cityId&&H(n.apartmentInfo.cityId),n.apartmentInfo.districtId&&q(n.apartmentInfo.districtId)}catch(n){console.log(n)}}async function ie(){try{await ke(o.value),M.success("操作成功"),E.back()}catch(t){console.log(t)}}function ue(){var t;(t=x.value)==null||t.validate(async a=>{if(a)await ie();else return M.error("表单填写有误，请检查"),!1})}return Ue(()=>{var t;j(),ae(),te(),le(),ne(),oe(),(t=T.query)!=null&&t.id&&de(T.query.id)}),(t,a)=>{const u=f("el-input"),d=f("el-form-item"),c=f("el-input-number"),p=f("el-option"),n=f("el-select"),m=f("el-radio"),ce=f("el-radio-group"),pe=f("el-tree-select"),me=f("el-form"),S=f("el-button"),fe=f("el-card");return i(),I(fe,null,{header:s(()=>[h("div",Ne,[h("span",null,k(o.value.id?"修改":"新增")+"房间",1)])]),default:s(()=>[r(me,{ref_key:"apartmentFormRef",ref:x,model:o.value,rules:K,"label-width":"120px",style:{"max-width":"660px"},"status-icon":""},{default:s(()=>[r(d,{label:"房间号",prop:"roomNumber"},{default:s(()=>[r(u,{modelValue:o.value.roomNumber,"onUpdate:modelValue":a[0]||(a[0]=e=>o.value.roomNumber=e)},null,8,["modelValue"])]),_:1}),r(d,{label:"租金（元/月）",prop:"rent"},{default:s(()=>[r(c,{modelValue:o.value.rent,"onUpdate:modelValue":a[1]||(a[1]=e=>o.value.rent=e),step:1,"step-strictly":""},null,8,["modelValue"])]),_:1}),r(d,{label:"所属公寓",required:""},{default:s(()=>[h("div",Oe,[r(d,{prop:"provinceId"},{default:s(()=>[r(n,{modelValue:l.provinceId,"onUpdate:modelValue":a[2]||(a[2]=e=>l.provinceId=e),placeholder:"请选择省份",clearable:"",onChange:G,onClear:J},{default:s(()=>[(i(!0),v(b,null,g(l.provinceList,e=>(i(),I(p,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),r(d,{prop:"cityId"},{default:s(()=>[r(n,{modelValue:l.cityId,"onUpdate:modelValue":a[3]||(a[3]=e=>l.cityId=e),placeholder:"请选择城市",clearable:"",onChange:Q,onClear:W},{default:s(()=>[(i(!0),v(b,null,g(l.cityList,e=>(i(),I(p,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),r(d,{prop:"districtId"},{default:s(()=>[r(n,{modelValue:l.districtId,"onUpdate:modelValue":a[4]||(a[4]=e=>l.districtId=e),placeholder:"请选择区域",clearable:"",onChange:X,onClear:Y},{default:s(()=>[(i(!0),v(b,null,g(l.districtList,e=>(i(),I(p,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),r(d,{prop:"apartmentId"},{default:s(()=>[r(n,{modelValue:l.apartmentId,"onUpdate:modelValue":a[5]||(a[5]=e=>l.apartmentId=e),placeholder:"请选择公寓",clearable:"",onChange:Z,onClear:ee},{default:s(()=>[(i(!0),v(b,null,g(l.apartmentList,e=>(i(),I(p,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})])]),_:1}),r(d,{label:"是否发布",prop:"isRelease"},{default:s(()=>[r(ce,{modelValue:o.value.isRelease,"onUpdate:modelValue":a[6]||(a[6]=e=>o.value.isRelease=e),class:"ml-4"},{default:s(()=>[r(m,{label:y(V).NOT_RELEASED},{default:s(()=>[w(k(y(P)(y(F),y(V).NOT_RELEASED)),1)]),_:1},8,["label"]),r(m,{label:y(V).RELEASED},{default:s(()=>[w(k(y(P)(y(F),y(V).RELEASED)),1)]),_:1},8,["label"])]),_:1},8,["modelValue"])]),_:1}),r(d,{label:"房间属性",prop:"attrValueIds"},{default:s(()=>[r(pe,{style:{width:"100%"},modelValue:o.value.attrValueIds,"onUpdate:modelValue":a[7]||(a[7]=e=>o.value.attrValueIds=e),placeholder:"请选择房间属性",data:R.value,multiple:"",clearable:"","node-key":"value","render-after-expand":!1,onNodeClick:re},null,8,["modelValue","data"])]),_:1}),r(d,{label:"房间配套",prop:"facilityInfoIds"},{default:s(()=>[r(n,{style:{width:"100%"},modelValue:o.value.facilityInfoIds,"onUpdate:modelValue":a[8]||(a[8]=e=>o.value.facilityInfoIds=e),placeholder:"请选择房间配套",multiple:"",clearable:""},{default:s(()=>[(i(!0),v(b,null,g(O.value,e=>(i(),I(p,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),r(d,{label:"房间标签",prop:"labelIds"},{default:s(()=>[r(n,{style:{width:"100%"},modelValue:o.value.labelInfoIds,"onUpdate:modelValue":a[9]||(a[9]=e=>o.value.labelInfoIds=e),placeholder:"请选择房间标签",multiple:"",clearable:""},{default:s(()=>[(i(!0),v(b,null,g(B.value,e=>(i(),I(p,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),r(d,{label:"支付方式",prop:"paymentTypeIds"},{default:s(()=>[r(n,{style:{width:"100%"},modelValue:o.value.paymentTypeIds,"onUpdate:modelValue":a[10]||(a[10]=e=>o.value.paymentTypeIds=e),placeholder:"请选择支付方式",multiple:"",clearable:""},{default:s(()=>[(i(!0),v(b,null,g(D.value,e=>(i(),I(p,{key:e.id,label:`${e.name} (${e.additionalInfo})`,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),r(d,{label:"可选租期",prop:"leaseTermIds"},{default:s(()=>[r(n,{style:{width:"100%"},modelValue:o.value.leaseTermIds,"onUpdate:modelValue":a[11]||(a[11]=e=>o.value.leaseTermIds=e),placeholder:"请选择可选租期",multiple:"",clearable:""},{default:s(()=>[(i(!0),v(b,null,g(A.value,e=>(i(),I(p,{key:e.id,label:`${e.monthCount}${e.unit}`,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),r(d,{label:"图片",prop:"graphVoList"},{default:s(()=>[r(we,{"file-list":o.value.graphVoList,"onUpdate:fileList":a[12]||(a[12]=e=>o.value.graphVoList=e),"on-success":se,"list-type":"picture-card",limit:5},null,8,["file-list"])]),_:1})]),_:1},8,["model","rules"]),h("div",Be,[r(S,{style:{width:"150px"},type:"info",onClick:a[13]||(a[13]=e=>y(E).back())},{default:s(()=>[w(" 取消 ")]),_:1}),r(S,{style:{width:"150px"},type:"primary",onClick:ue},{default:s(()=>[w(k(o.value.id?"保存":"新增"),1)]),_:1})])]),_:1})}}});const ze=qe(De,[["__scopeId","data-v-3bc48206"]]);export{ze as default};
