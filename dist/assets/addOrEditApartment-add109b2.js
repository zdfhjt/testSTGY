import{A as B,g as X,b as Z,B as ee}from"./constEnums-c94e3170.js";import{a as fe,e as ve,f as me,h as ge,i as Ie,b as Ae,c as ye,s as be}from"./index-87660c7d.js";import{a2 as Me,J as _e,r as E,K as le,a3 as Le,a4 as we,a5 as he,z as Y,d as Ve,f as Ue,x as Ce,S as ae,a as V,o as _,h as D,i as f,l as F,t as J,e as d,c as S,B as N,F as O,O as U,b as $,n as Ee,_ as ke}from"./index-f83309f8.js";import{_ as xe}from"./uploadImg.vue_vue_type_script_setup_true_lang-09a00989.js";import"./index-2a3f9cb3.js";var te={exports:{}};(function(q,k){(function(M,C){q.exports=C()})(Me,function(){function M(e){var I=[];return e.AMapUI&&I.push(C(e.AMapUI)),e.Loca&&I.push(l(e.Loca)),Promise.all(I)}function C(e){return new Promise(function(I,r){var v=[];if(e.plugins)for(var p=0;p<e.plugins.length;p+=1)n.AMapUI.plugins.indexOf(e.plugins[p])==-1&&v.push(e.plugins[p]);if(m.AMapUI===u.failed)r("前次请求 AMapUI 失败");else if(m.AMapUI===u.notload){m.AMapUI=u.loading,n.AMapUI.version=e.version||n.AMapUI.version,p=n.AMapUI.version;var b=document.body||document.head,y=document.createElement("script");y.type="text/javascript",y.src="https://webapi.amap.com/ui/"+p+"/main.js",y.onerror=function(c){m.AMapUI=u.failed,r("请求 AMapUI 失败")},y.onload=function(){if(m.AMapUI=u.loaded,v.length)window.AMapUI.loadUI(v,function(){for(var c=0,w=v.length;c<w;c++){var x=v[c].split("/").slice(-1)[0];window.AMapUI[x]=arguments[c]}for(I();L.AMapUI.length;)L.AMapUI.splice(0,1)[0]()});else for(I();L.AMapUI.length;)L.AMapUI.splice(0,1)[0]()},b.appendChild(y)}else m.AMapUI===u.loaded?e.version&&e.version!==n.AMapUI.version?r("不允许多个版本 AMapUI 混用"):v.length?window.AMapUI.loadUI(v,function(){for(var c=0,w=v.length;c<w;c++){var x=v[c].split("/").slice(-1)[0];window.AMapUI[x]=arguments[c]}I()}):I():e.version&&e.version!==n.AMapUI.version?r("不允许多个版本 AMapUI 混用"):L.AMapUI.push(function(c){c?r(c):v.length?window.AMapUI.loadUI(v,function(){for(var w=0,x=v.length;w<x;w++){var K=v[w].split("/").slice(-1)[0];window.AMapUI[K]=arguments[w]}I()}):I()})})}function l(e){return new Promise(function(I,r){if(m.Loca===u.failed)r("前次请求 Loca 失败");else if(m.Loca===u.notload){m.Loca=u.loading,n.Loca.version=e.version||n.Loca.version;var v=n.Loca.version,p=n.AMap.version.startsWith("2"),b=v.startsWith("2");if(p&&!b||!p&&b)r("JSAPI 与 Loca 版本不对应！！");else{p=n.key,b=document.body||document.head;var y=document.createElement("script");y.type="text/javascript",y.src="https://webapi.amap.com/loca?v="+v+"&key="+p,y.onerror=function(c){m.Loca=u.failed,r("请求 AMapUI 失败")},y.onload=function(){for(m.Loca=u.loaded,I();L.Loca.length;)L.Loca.splice(0,1)[0]()},b.appendChild(y)}}else m.Loca===u.loaded?e.version&&e.version!==n.Loca.version?r("不允许多个版本 Loca 混用"):I():e.version&&e.version!==n.Loca.version?r("不允许多个版本 Loca 混用"):L.Loca.push(function(c){c?r(c):r()})})}if(!window)throw Error("AMap JSAPI can only be used in Browser.");var u;(function(e){e.notload="notload",e.loading="loading",e.loaded="loaded",e.failed="failed"})(u||(u={}));var n={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},m={AMap:u.notload,AMapUI:u.notload,Loca:u.notload},L={AMap:[],AMapUI:[],Loca:[]},P=[],T=function(e){typeof e=="function"&&(m.AMap===u.loaded?e(window.AMap):P.push(e))};return{load:function(e){return new Promise(function(I,r){if(m.AMap==u.failed)r("");else if(m.AMap==u.notload){var v=e.key,p=e.version,b=e.plugins;v?(window.AMap&&location.host!=="lbs.amap.com"&&r("禁止多种API加载方式混用"),n.key=v,n.AMap.version=p||n.AMap.version,n.AMap.plugins=b||n.AMap.plugins,m.AMap=u.loading,p=document.body||document.head,window.___onAPILoaded=function(c){if(delete window.___onAPILoaded,c)m.AMap=u.failed,r(c);else for(m.AMap=u.loaded,M(e).then(function(){I(window.AMap)}).catch(r);P.length;)P.splice(0,1)[0]()},b=document.createElement("script"),b.type="text/javascript",b.src="https://webapi.amap.com/maps?callback=___onAPILoaded&v="+n.AMap.version+"&key="+v+"&plugin="+n.AMap.plugins.join(","),b.onerror=function(c){m.AMap=u.failed,r(c)},p.appendChild(b)):r("请填写key")}else if(m.AMap==u.loaded)if(e.key&&e.key!==n.key)r("多个不一致的 key");else if(e.version&&e.version!==n.AMap.version)r("不允许多个版本 JSAPI 混用");else{if(v=[],e.plugins)for(p=0;p<e.plugins.length;p+=1)n.AMap.plugins.indexOf(e.plugins[p])==-1&&v.push(e.plugins[p]);v.length?window.AMap.plugin(v,function(){M(e).then(function(){I(window.AMap)}).catch(r)}):M(e).then(function(){I(window.AMap)}).catch(r)}else if(e.key&&e.key!==n.key)r("多个不一致的 key");else if(e.version&&e.version!==n.AMap.version)r("不允许多个版本 JSAPI 混用");else{var y=[];if(e.plugins)for(p=0;p<e.plugins.length;p+=1)n.AMap.plugins.indexOf(e.plugins[p])==-1&&y.push(e.plugins[p]);T(function(){y.length?window.AMap.plugin(y,function(){M(e).then(function(){I(window.AMap)}).catch(r)}):M(e).then(function(){I(window.AMap)}).catch(r)})}})},reset:function(){delete window.AMap,delete window.AMapUI,delete window.Loca,n={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},m={AMap:u.notload,AMapUI:u.notload,Loca:u.notload},L={AMap:[],AMapUI:[],Loca:[]}}}})})(te);var De=te.exports;const Pe=_e(De),Re=({domId:q}={})=>{const k=E(),M=E();async function C(){try{window._AMapSecurityConfig={securityJsCode:we},k.value=await Pe.load({key:he,version:"2.0",plugins:[]}),M.value=q&&new k.value.Map(q)}catch(u){console.log(u),Y.error((u==null?void 0:u.message)||"Has Error")}}function l(){M.value&&M.value.destroy()}return le(()=>{C()}),Le(()=>{l()}),{map:M,AMap:k}},Se={class:"card-header"},Ne={class:"flex-center"},Oe={class:"flex-center m-t-20"},qe=Ve({__name:"addOrEditApartment",setup(q){const k=Ue(),M=Ce(),C=E(),l=E({id:"",name:"",introduction:"",districtId:"",districtName:"",cityId:"",cityName:"",provinceId:"",provinceName:"",addressDetail:"",latitude:"",longitude:"",phone:"",isRelease:B.NOT_RELEASED,facilityInfoIds:[],labelIds:[],feeValueIds:[],graphVoList:[]}),u=ae({name:[{required:!0,message:"请输入公寓名称",trigger:"blur"}],introduction:[{required:!0,message:"请输入公寓介绍",trigger:"blur"}],provinceId:[{required:!0,message:"请选择省份",trigger:"change"}],cityId:[{required:!0,message:"请选择城市",trigger:"change"}],districtId:[{required:!0,message:"请选择区域",trigger:"change"}],addressDetail:[{required:!0,message:"请选择详细地址",trigger:"change"}],phone:[{required:!0,message:"请输入公寓前台电话",trigger:"blur"}],graphVoList:[{required:!0,message:"请上传图片",trigger:"change"}]}),n=ae({provinceList:[],cityList:[],districtList:[]});async function m(){try{const{data:t}=await fe();n.provinceList=t}catch(t){console.log(t)}}async function L(t=l.value.provinceId){if(t)try{const{data:a}=await Ae(t);n.cityList=a}catch(a){console.log(a)}}async function P(t=l.value.cityId){if(t)try{const{data:a}=await ye(t);n.districtList=a}catch(a){console.log(a)}}function T(){l.value.cityId="",n.cityList=[]}function e(){l.value.districtId="",n.districtList=[]}const I=async()=>{let t=l.value.provinceId;t&&(T(),e(),await L(t))},r=()=>{l.value.provinceId="",T(),e()},v=async()=>{let t=l.value.cityId;t&&(e(),await P(t))},p=()=>{console.log("清空城市"),l.value.cityId="",e()},b=async()=>{console.log("区域改变")},y=()=>{console.log("清空区域"),l.value.districtId=""},c=E([]),{AMap:w}=Re();function x(t){var a,g;if(t.trim()){const s=((a=n.provinceList.find(A=>A.id===l.value.provinceId))==null?void 0:a.name)||"",i=((g=n.districtList.find(A=>A.id===l.value.districtId))==null?void 0:g.name)||"";t=s+i+t,w.value.plugin("AMap.AutoComplete",function(){let A={city:"全国"};console.log("AMap",w.value),console.log("keywords",t),new w.value.AutoComplete(A).search(t,function(Q,R){var j;console.log("result",R),c.value=((j=R==null?void 0:R.tips)==null?void 0:j.map(h=>({label:h.district+h.name+h.address,value:h.district+h.name+h.address,location:h.location})))||[]})})}else c.value=[]}function K(t){var g,s;const a=c.value.find(i=>i.value===t);a&&(l.value.longitude=((g=a.location)==null?void 0:g.lng)||"",l.value.latitude=((s=a.location)==null?void 0:s.lat)||"")}const z=E([]),G=E([]),W=E([]);async function oe(){try{const{data:t}=await ve(ee.APARTMENT);z.value=t}catch(t){console.log(t)}}async function ne(){try{const{data:t}=await me(ee.APARTMENT);G.value=t}catch(t){console.log(t)}}async function ie(){try{const{data:t}=await ge();W.value=t.map(a=>({value:a.id+a.name,label:a.name,children:a.feeValueList.map(g=>({value:g.id,label:`${g.name} ${g.unit}(${a.name})`,parentId:a.id+a.name}))}))}catch(t){console.log(t)}}function ue(t){var a,g;if(t.parentId){const s=(g=(a=W.value.find(i=>i.value===t.parentId))==null?void 0:a.children)==null?void 0:g.map(i=>i.value);Ee(()=>{var i,A;l.value.feeValueIds=(i=l.value.feeValueIds)==null?void 0:i.filter(H=>!(s!=null&&s.includes(H))),(A=l.value.feeValueIds)==null||A.push(t.value)})}}function se(t,a,g){l.value.graphVoList=g==null?void 0:g.map(s=>{var i;return{...s,url:((i=s==null?void 0:s.response)==null?void 0:i.data)||s.url}})}async function re(t){var a,g,s;try{const{data:i}=await Ie(t);i.facilityInfoIds=(a=i.facilityInfoList)==null?void 0:a.map(A=>A.id),delete i.facilityInfoList,i.labelIds=(g=i.labelInfoList)==null?void 0:g.map(A=>A.id),delete i.labelInfoList,i.feeValueIds=(s=i.feeValueVoList)==null?void 0:s.map(A=>A.id),delete i.feeValueVoList,c.value=[{label:i.addressDetail,value:i.addressDetail,location:{lng:i.longitude,lat:i.latitude}}],l.value=i,console.log(l.value.provinceId,l.value.cityId),l.value.provinceId&&L(l.value.provinceId),l.value.cityId&&P(l.value.cityId)}catch(i){console.log(i)}}async function de(){try{await be(l.value),Y.success("操作成功"),M.back()}catch(t){console.log(t)}}function ce(){var t;(t=C.value)==null||t.validate(async a=>{if(a)await de();else return Y.error("表单填写有误，请检查"),!1})}return le(()=>{var t;m(),oe(),ne(),ie(),(t=k.query)!=null&&t.id&&re(k.query.id)}),(t,a)=>{const g=V("el-input"),s=V("el-form-item"),i=V("el-option"),A=V("el-select"),H=V("el-radio"),Q=V("el-radio-group"),R=V("el-tree-select"),j=V("el-form"),h=V("el-button"),pe=V("el-card");return _(),D(pe,null,{header:f(()=>[F("div",Se,[F("span",null,J(l.value.id?"修改":"新增")+"公寓",1)])]),default:f(()=>[d(j,{ref_key:"apartmentFormRef",ref:C,model:l.value,rules:u,"label-width":"120px",style:{"max-width":"660px"},"status-icon":""},{default:f(()=>[d(s,{label:"公寓名称",prop:"name"},{default:f(()=>[d(g,{modelValue:l.value.name,"onUpdate:modelValue":a[0]||(a[0]=o=>l.value.name=o)},null,8,["modelValue"])]),_:1}),d(s,{label:"公寓介绍",prop:"introduction"},{default:f(()=>[d(g,{type:"textarea",modelValue:l.value.introduction,"onUpdate:modelValue":a[1]||(a[1]=o=>l.value.introduction=o)},null,8,["modelValue"])]),_:1}),d(s,{label:"所处区域",required:""},{default:f(()=>[F("div",Ne,[d(s,{prop:"provinceId"},{default:f(()=>[d(A,{modelValue:l.value.provinceId,"onUpdate:modelValue":a[2]||(a[2]=o=>l.value.provinceId=o),placeholder:"请选择省份",clearable:"",onChange:I,onClear:r},{default:f(()=>[(_(!0),S(O,null,N(n.provinceList,o=>(_(),D(i,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),d(s,{prop:"cityId"},{default:f(()=>[d(A,{modelValue:l.value.cityId,"onUpdate:modelValue":a[3]||(a[3]=o=>l.value.cityId=o),placeholder:"请选择城市",clearable:"",onChange:v,onClear:p},{default:f(()=>[(_(!0),S(O,null,N(n.cityList,o=>(_(),D(i,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),d(s,{prop:"districtId"},{default:f(()=>[d(A,{modelValue:l.value.districtId,"onUpdate:modelValue":a[4]||(a[4]=o=>l.value.districtId=o),placeholder:"请选择区域",clearable:"",onChange:b,onClear:y},{default:f(()=>[(_(!0),S(O,null,N(n.districtList,o=>(_(),D(i,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})])]),_:1}),d(s,{label:"详细地址",prop:"addressDetail"},{default:f(()=>[d(A,{modelValue:l.value.addressDetail,"onUpdate:modelValue":a[5]||(a[5]=o=>l.value.addressDetail=o),filterable:"",remote:"",clearable:"",placeholder:"请输入详细地址查询","remote-method":x,style:{width:"100%"},onChange:K},{default:f(()=>[(_(!0),S(O,null,N(c.value,o=>(_(),D(i,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),d(s,{label:"公寓前台电话",prop:"phone"},{default:f(()=>[d(g,{modelValue:l.value.phone,"onUpdate:modelValue":a[6]||(a[6]=o=>l.value.phone=o)},null,8,["modelValue"])]),_:1}),d(s,{label:"是否发布",prop:"isRelease"},{default:f(()=>[d(Q,{modelValue:l.value.isRelease,"onUpdate:modelValue":a[7]||(a[7]=o=>l.value.isRelease=o),class:"ml-4"},{default:f(()=>[d(H,{label:U(B).NOT_RELEASED},{default:f(()=>[$(J(U(X)(U(Z),U(B).NOT_RELEASED)),1)]),_:1},8,["label"]),d(H,{label:U(B).RELEASED},{default:f(()=>[$(J(U(X)(U(Z),U(B).RELEASED)),1)]),_:1},8,["label"])]),_:1},8,["modelValue"])]),_:1}),d(s,{label:"公寓配套",prop:"facilityInfoIds"},{default:f(()=>[d(A,{style:{width:"100%"},modelValue:l.value.facilityInfoIds,"onUpdate:modelValue":a[8]||(a[8]=o=>l.value.facilityInfoIds=o),placeholder:"请选择公寓配套",multiple:"",clearable:""},{default:f(()=>[(_(!0),S(O,null,N(z.value,o=>(_(),D(i,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),d(s,{label:"公寓标签",prop:"labelIds"},{default:f(()=>[d(A,{style:{width:"100%"},modelValue:l.value.labelIds,"onUpdate:modelValue":a[9]||(a[9]=o=>l.value.labelIds=o),placeholder:"请选择公寓标签",multiple:"",clearable:""},{default:f(()=>[(_(!0),S(O,null,N(G.value,o=>(_(),D(i,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),d(s,{label:"公寓杂费",prop:"feeValueIds"},{default:f(()=>[d(R,{style:{width:"100%"},modelValue:l.value.feeValueIds,"onUpdate:modelValue":a[10]||(a[10]=o=>l.value.feeValueIds=o),placeholder:"请选择公寓杂费",data:W.value,multiple:"",clearable:"","node-key":"value","render-after-expand":!1,onNodeClick:ue},null,8,["modelValue","data"])]),_:1}),d(s,{label:"图片",prop:"graphVoList"},{default:f(()=>[d(xe,{"file-list":l.value.graphVoList,"onUpdate:fileList":a[11]||(a[11]=o=>l.value.graphVoList=o),"on-success":se,"list-type":"picture-card",limit:5},null,8,["file-list"])]),_:1})]),_:1},8,["model","rules"]),F("div",Oe,[d(h,{style:{width:"150px"},type:"info",onClick:a[12]||(a[12]=o=>U(M).back())},{default:f(()=>[$(" 取消 ")]),_:1}),d(h,{style:{width:"150px"},type:"primary",onClick:ce},{default:f(()=>[$(J(l.value.id?"保存":"新增"),1)]),_:1})])]),_:1})}}});const Je=ke(qe,[["__scopeId","data-v-31495adf"]]);export{Je as default};
