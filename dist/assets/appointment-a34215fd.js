import{d as F,r as x,S as h,K as H,a as r,o as W,h as U,i as f,e as i,O as b,b as j,a1 as G,z as O,a0 as q}from"./index-f83309f8.js";import{a as z,b as K,c as R,m as X}from"./index-87660c7d.js";import{h as c,g as u,i as m}from"./constEnums-c94e3170.js";import{g as $,u as J}from"./index-5f02018d.js";import"./index-2a3f9cb3.js";function o(I){return typeof I=="function"||Object.prototype.toString.call(I)==="[object Object]"&&!q(I)}const le=F({__name:"appointment",setup(I){const l=x(),a=h({provinceList:[],provinceId:"",cityList:[],cityId:"",districtList:[],districtId:"",apartmentList:[],apartmentId:""}),g=[{prop:"name",label:"姓名",search:{el:"input",props:{placeholder:"请输入姓名"}}},{prop:"phone",label:"手机",search:{el:"input",props:{placeholder:"请输入手机号"}}},{prop:"provinceId",label:"省份",isShow:!1,fieldNames:{label:"name",value:"id"},search:{el:"select",render:()=>{let e;return i(r("el-select"),{modelValue:a.provinceId,"onUpdate:modelValue":t=>a.provinceId=t,placeholder:"请选择省份",clearable:!0,key:"provinceId",onChange:P,onClear:E},o(e=a.provinceList.map(t=>i(r("el-option"),{key:t.id,label:t.name,value:t.id},null)))?e:{default:()=>[e]})}}},{prop:"cityId",label:"城市",isShow:!1,fieldNames:{label:"name",value:"id"},search:{el:"select",key:"cityId",render:()=>{let e;return i(r("el-select"),{modelValue:a.cityId,"onUpdate:modelValue":t=>a.cityId=t,placeholder:"请选择城市",clearable:!0,key:"cityId",onChange:w,onClear:V},o(e=a.cityList.map(t=>i(r("el-option"),{key:t.id,label:t.name,value:t.id},null)))?e:{default:()=>[e]})}}},{prop:"districtId",label:"区域",isShow:!1,fieldNames:{label:"name",value:"id"},search:{el:"select",key:"districtId",render:()=>{let e;return i(r("el-select"),{modelValue:a.districtId,"onUpdate:modelValue":t=>a.districtId=t,placeholder:"请选择区域",clearable:!0,onChange:A,onClear:N},o(e=a.districtList.map(t=>i(r("el-option"),{key:t.id,label:t.name,value:t.id},null)))?e:{default:()=>[e]})}}},{prop:"apartmentId",label:"公寓",isShow:!1,fieldNames:{label:"name",value:"id"},search:{el:"select",key:"apartmentId",render:()=>{let e;return i(r("el-select"),{modelValue:a.apartmentId,"onUpdate:modelValue":t=>a.apartmentId=t,placeholder:"请选择公寓",clearable:!0,onChange:D,onClear:B},o(e=a.apartmentList.map(t=>i(r("el-option"),{key:t.id,label:t.name,value:t.id},null)))?e:{default:()=>[e]})}}},{prop:"apartmentInfo.provinceName",label:"所处省份"},{prop:"apartmentInfo.cityName",label:"所处城市"},{prop:"apartmentInfo.districtName",label:"所处区域"},{prop:"apartmentInfo.name",label:"所处公寓"},{prop:"appointmentTime",label:"预约时间"},{prop:"additionalInfo",label:"备注信息"},{prop:"appointmentStatus",label:"预约状态",render:({row:e})=>{let t,n,d,s;switch(e.appointmentStatus){case c.WAITING:return i(r("el-tag"),{type:"success"},o(t=u(m,e.appointmentStatus))?t:{default:()=>[t]});case c.CANCELLED:return i(r("el-tag"),{type:"warning"},o(n=u(m,e.appointmentStatus))?n:{default:()=>[n]});case c.VIEWED:return i(r("el-tag"),{type:"info"},o(d=u(m,e.appointmentStatus))?d:{default:()=>[d]});case c.EXPIRED:return i(r("el-tag"),{type:"danger"},o(s=u(m,e.appointmentStatus))?s:{default:()=>[s]});default:return i(r("el-tag"),{type:"info"},{default:()=>[u(m,e.appointmentStatus)||"—"]})}}},{prop:"operation",label:"操作",fixed:"right",width:150}],C=h({});async function L(){var e;try{const{data:t}=await z();a.provinceList=t,(e=l.value)==null||e.enumMap.set("provinceId",a.provinceList)}catch(t){console.log(t)}}async function _(e){var t;try{const{data:n}=await K(e);a.cityList=n,(t=l.value)==null||t.enumMap.set("cityId",a.cityList)}catch(n){console.log(n)}}async function k(e){var t;try{const{data:n}=await R(e);a.districtList=n,(t=l.value)==null||t.enumMap.set("districtId",a.districtList)}catch(n){console.log(n)}}async function S(e){var t;try{const{data:n}=await X(e);a.apartmentList=n,(t=l.value)==null||t.enumMap.set("apartmentId",a.apartmentList)}catch(n){console.log(n)}}function v(){var e;a.cityId="",a.cityList=[],(e=l.value)==null||e.enumMap.set("cityId",[]),l.value.searchParam.cityId=""}function y(){var e;a.districtId="",a.districtList=[],(e=l.value)==null||e.enumMap.set("districtId",[]),l.value.searchParam.districtId=""}function p(){var e;a.apartmentId="",a.apartmentList=[],(e=l.value)==null||e.enumMap.set("apartmentId",[]),l.value.searchParam.apartmentId=""}const P=async()=>{let e=l.value.searchParam.provinceId;e&&(v(),y(),p(),await _(e))},E=()=>{a.provinceId="",l.value.searchParam.provinceId="",v(),y(),p()},w=async()=>{let e=l.value.searchParam.cityId;e&&(y(),p(),await k(e))},V=()=>{console.log("清空城市"),a.cityId="",l.value.searchParam.cityId="",y(),p()},A=async()=>{let e=l.value.searchParam.districtId;e&&(p(),await S(e))},N=()=>{console.log("清空区域"),a.districtId="",l.value.searchParam.districtId="",p()},D=async()=>{console.log("公寓改变")},B=()=>{console.log("清空公寓"),a.apartmentId="",l.value.searchParam.apartmentId=""},M=e=>({list:e==null?void 0:e.records,total:e==null?void 0:e.total}),T=async e=>{var t;try{await J(e.id,c.VIEWED),(t=l.value)==null||t.getTableList(),O.success("操作成功")}catch(n){console.log(n)}};return H(()=>{L()}),(e,t)=>{const n=r("el-button"),d=r("el-card");return W(),U(d,null,{default:f(()=>[i(G,{ref_key:"proTable",ref:l,dataCallback:M,columns:g,requestApi:b($),initParam:C,stripe:!0},{operation:f(s=>[i(n,{type:s.row.appointmentStatus===b(c).WAITING?"primary":"info",icon:"View",disabled:s.row.appointmentStatus!==b(c).WAITING,onClick:Q=>T(s.row)},{default:f(()=>[j(" 带看 ")]),_:2},1032,["type","disabled","onClick"])]),_:1},8,["requestApi","initParam"])]),_:1})}}});export{le as default};
