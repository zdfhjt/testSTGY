import{a as oe,o as ne,p as re,b as de,c as ie,m as se}from"./index-87660c7d.js";import{d as ue,f as ce,x as me,r as _,S as E,w as pe,K as fe,a as s,o as i,h as c,i as n,l as V,t as H,e as o,c as f,B as I,F as y,b as B,O as Ie,z as S,_ as ye}from"./index-f83309f8.js";import{j as ve,m as be}from"./constEnums-c94e3170.js";import{c as ge,e as _e,s as Ve}from"./index-5f02018d.js";import"./index-2a3f9cb3.js";const Ce={class:"card-header"},Le={class:"flex-center"},ke={class:"flex-center m-t-20"},we=ue({__name:"addOrEditAgreement",setup(De){const C=ce(),L=me(),k=_(),r=_({id:"",name:"",phone:"",identificationNumber:"",apartmentId:"",roomId:"",leaseStartDate:"",leaseEndDate:"",leaseTermId:"",rent:0,deposit:0,paymentTypeId:"",status:ve.WAITING,sourceType:be.NEW,additionalInfo:""}),R=E({roomNumber:[{required:!0,message:"请输入房间号",trigger:"blur"}]}),a=E({provinceList:[],provinceId:"",cityList:[],cityId:"",districtList:[],districtId:"",apartmentList:[],apartmentId:"",roomList:[],roomId:""});pe(()=>a,l=>{r.value.apartmentId=l.apartmentId,r.value.roomId=l.roomId},{immediate:!0,deep:!0});async function O(){try{const{data:l}=await oe();a.provinceList=l}catch(l){console.log(l)}}async function w(l=a.provinceId){try{const{data:e}=await de(l);a.cityList=e}catch(e){console.log(e)}}async function D(l=a.cityId){try{const{data:e}=await ie(l);a.districtList=e}catch(e){console.log(e)}}async function h(l=a.districtId){try{const{data:e}=await se(l);a.apartmentList=e}catch(e){console.log(e)}}async function U(l=a.apartmentId){try{const{data:e}=await _e(l);a.roomList=e}catch(e){console.log(e)}}function Y(){a.cityId="",a.cityList=[]}function b(){a.districtId="",a.districtList=[]}function v(){a.apartmentId="",a.apartmentList=[]}function u(){a.roomId="",a.roomList=[]}const $=async()=>{let l=a.provinceId;l&&(Y(),b(),v(),u(),await w(l))},q=()=>{a.provinceId="",Y(),b(),v(),u()},F=async()=>{let l=a.cityId;l&&(b(),v(),u(),await D(l))},P=()=>{console.log("清空城市"),a.cityId="",b(),v(),u()},W=async()=>{let l=a.districtId;l&&(v(),u(),await h(l))},j=()=>{console.log("清空区域"),a.districtId="",v(),u()},z=async()=>{console.log("公寓改变");let l=a.apartmentId;l&&(u(),await U(l))},G=()=>{console.log("清空公寓"),a.apartmentId="",u()},K=async()=>{console.log("房间改变")},J=()=>{console.log("清空房间"),a.roomId=""},x=_([]),A=_([]);async function Q(){try{const{data:l}=await ne();x.value=l}catch(l){console.log(l)}}async function X(){try{const{data:l}=await re();A.value=l}catch(l){console.log(l)}}async function Z(l){try{const{data:e}=await ge(l);r.value=e,a.provinceId=e.apartmentInfo.provinceId,a.cityId=e.apartmentInfo.cityId,a.districtId=e.apartmentInfo.districtId,a.apartmentId=e.apartmentId,a.roomId=e.roomId,e.apartmentInfo.provinceId&&await w(e.apartmentInfo.provinceId),e.apartmentInfo.cityId&&await D(e.apartmentInfo.cityId),e.apartmentInfo.districtId&&await h(e.apartmentInfo.districtId),e.apartmentId&&await U(e.apartmentId)}catch(e){console.log(e)}}async function ee(){try{await Ve(r.value),S.success("操作成功"),L.back()}catch(l){console.log(l)}}function te(){var l;(l=k.value)==null||l.validate(async e=>{if(e)await ee();else return S.error("表单填写有误，请检查"),!1})}return fe(()=>{var l;O(),Q(),X(),(l=C.query)!=null&&l.id&&Z(C.query.id)}),(l,e)=>{const g=s("el-input"),d=s("el-form-item"),m=s("el-option"),p=s("el-select"),M=s("el-date-picker"),T=s("el-input-number"),ae=s("el-form"),N=s("el-button"),le=s("el-card");return i(),c(le,null,{header:n(()=>[V("div",Ce,[V("span",null,H(r.value.id?"修改":"新增")+"租约",1)])]),default:n(()=>[o(ae,{ref_key:"apartmentFormRef",ref:k,model:r.value,rules:R,"label-width":"120px",style:{"max-width":"1000px"},"status-icon":""},{default:n(()=>[o(d,{label:"姓名",prop:"name"},{default:n(()=>[o(g,{modelValue:r.value.name,"onUpdate:modelValue":e[0]||(e[0]=t=>r.value.name=t),modelModifiers:{trim:!0},placeholder:"请输入姓名"},null,8,["modelValue"])]),_:1}),o(d,{label:"手机号码",prop:"phone"},{default:n(()=>[o(g,{modelValue:r.value.phone,"onUpdate:modelValue":e[1]||(e[1]=t=>r.value.phone=t),modelModifiers:{trim:!0},placeholder:"请输入手机号码"},null,8,["modelValue"])]),_:1}),o(d,{label:"身份证号码",prop:"identificationNumber"},{default:n(()=>[o(g,{modelValue:r.value.identificationNumber,"onUpdate:modelValue":e[2]||(e[2]=t=>r.value.identificationNumber=t),modelModifiers:{trim:!0},placeholder:"请输入身份证号码"},null,8,["modelValue"])]),_:1}),o(d,{label:"房间",required:""},{default:n(()=>[V("div",Le,[o(d,{prop:"provinceId"},{default:n(()=>[o(p,{modelValue:a.provinceId,"onUpdate:modelValue":e[3]||(e[3]=t=>a.provinceId=t),placeholder:"请选择省份",clearable:"",onChange:$,onClear:q},{default:n(()=>[(i(!0),f(y,null,I(a.provinceList,t=>(i(),c(m,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(d,{prop:"cityId"},{default:n(()=>[o(p,{modelValue:a.cityId,"onUpdate:modelValue":e[4]||(e[4]=t=>a.cityId=t),placeholder:"请选择城市",clearable:"",onChange:F,onClear:P},{default:n(()=>[(i(!0),f(y,null,I(a.cityList,t=>(i(),c(m,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(d,{prop:"districtId"},{default:n(()=>[o(p,{modelValue:a.districtId,"onUpdate:modelValue":e[5]||(e[5]=t=>a.districtId=t),placeholder:"请选择区域",clearable:"",onChange:W,onClear:j},{default:n(()=>[(i(!0),f(y,null,I(a.districtList,t=>(i(),c(m,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(d,{prop:"apartmentId"},{default:n(()=>[o(p,{modelValue:a.apartmentId,"onUpdate:modelValue":e[6]||(e[6]=t=>a.apartmentId=t),placeholder:"请选择公寓",clearable:"",filterable:"",onChange:z,onClear:G},{default:n(()=>[(i(!0),f(y,null,I(a.apartmentList,t=>(i(),c(m,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(d,{prop:"roomId"},{default:n(()=>[o(p,{modelValue:a.roomId,"onUpdate:modelValue":e[7]||(e[7]=t=>a.roomId=t),placeholder:"请选择房间",clearable:"",filterable:"",onChange:K,onClear:J},{default:n(()=>[(i(!0),f(y,null,I(a.roomList,t=>(i(),c(m,{key:t.id,label:t.roomNumber,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})])]),_:1}),o(d,{label:"开始时间",prop:"leaseStartDate"},{default:n(()=>[o(M,{modelValue:r.value.leaseStartDate,"onUpdate:modelValue":e[8]||(e[8]=t=>r.value.leaseStartDate=t),type:"date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",placeholder:"开始时间",clearable:""},null,8,["modelValue"])]),_:1}),o(d,{label:"结束时间",prop:"leaseEndDate"},{default:n(()=>[o(M,{modelValue:r.value.leaseEndDate,"onUpdate:modelValue":e[9]||(e[9]=t=>r.value.leaseEndDate=t),type:"date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",placeholder:"结束时间",clearable:""},null,8,["modelValue"])]),_:1}),o(d,{label:"支付方式",prop:"paymentTypeIds"},{default:n(()=>[o(p,{style:{width:"100%"},modelValue:r.value.paymentTypeId,"onUpdate:modelValue":e[10]||(e[10]=t=>r.value.paymentTypeId=t),placeholder:"请选择支付方式",clearable:""},{default:n(()=>[(i(!0),f(y,null,I(x.value,t=>(i(),c(m,{key:t.id,label:`${t.name} (${t.additionalInfo})`,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(d,{label:"可选租期",prop:"leaseTermIds"},{default:n(()=>[o(p,{style:{width:"100%"},modelValue:r.value.leaseTermId,"onUpdate:modelValue":e[11]||(e[11]=t=>r.value.leaseTermId=t),placeholder:"请选择租期",clearable:""},{default:n(()=>[(i(!0),f(y,null,I(A.value,t=>(i(),c(m,{key:t.id,label:`${t.monthCount}${t.unit}`,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(d,{label:"租金（元/月）",prop:"rent"},{default:n(()=>[o(T,{modelValue:r.value.rent,"onUpdate:modelValue":e[12]||(e[12]=t=>r.value.rent=t),step:1,"step-strictly":""},null,8,["modelValue"])]),_:1}),o(d,{label:"押金（元）",prop:"deposit"},{default:n(()=>[o(T,{modelValue:r.value.deposit,"onUpdate:modelValue":e[13]||(e[13]=t=>r.value.deposit=t),step:1,"step-strictly":""},null,8,["modelValue"])]),_:1}),o(d,{label:"备注信息",prop:"additionalInfo"},{default:n(()=>[o(g,{modelValue:r.value.additionalInfo,"onUpdate:modelValue":e[14]||(e[14]=t=>r.value.additionalInfo=t),modelModifiers:{trim:!0},type:"textarea",placeholder:"请输入备注信息"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),V("div",ke,[o(N,{style:{width:"150px"},type:"info",onClick:e[15]||(e[15]=t=>Ie(L).back())},{default:n(()=>[B(" 取消 ")]),_:1}),o(N,{style:{width:"150px"},type:"primary",onClick:te},{default:n(()=>[B(H(r.value.id?"保存":"新增"),1)]),_:1})])]),_:1})}}});const Me=ye(we,[["__scopeId","data-v-d4f3526e"]]);export{Me as default};
