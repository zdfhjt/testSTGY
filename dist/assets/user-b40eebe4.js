import{S as q,g as G,a as T}from"./constEnums-c94e3170.js";import{c as Q,g as W,a as X,u as Y,b as Z,d as ee,e as le,f as te,h as ae}from"./index-54c3d6fd.js";import{d as B,r as v,S as R,w as oe,a as m,o as p,h as f,i as r,e as u,b,k as g,c as L,B as U,F as S,O as M,z as x,t as E,K as re,a0 as se}from"./index-f83309f8.js";import{u as A}from"./useHandleData-6b7335ab.js";import"./index-2a3f9cb3.js";const ne=B({__name:"UserDrawer",setup(k,{expose:_}){const D=v({}),w=v(!1),l=v({title:""}),y=v(!1),V=R({username:[{required:!0,validator:async(o,e,n)=>{if(!e)return n(new Error("请输入用户名"));if(e.length<4)return n(new Error("用户名不能小于4位"));if(e.length>20)return n(new Error("用户名不能大于20位"));if(e===D.value.username)return n();try{const{data:d}=await Q(e);if(!d)return n(new Error("用户名已存在"));n()}catch(d){console.error(d),n(new Error("用户名校验失败"))}},trigger:"blur"}],password:[{required:!0,message:"请填写用户密码",trigger:"blur"},{min:6,message:"密码不能小于6位"}],confirmPassword:[{validator:async(o,e,n)=>{var d;return e===((d=l.value.rowData)==null?void 0:d.password)?n():n(new Error("两次输入密码不一致"))},trigger:"blur"}],name:[{required:!0,message:"请填写用户昵称",trigger:"blur"}],phone:[{required:!0,message:"请填写用户手机",trigger:"blur"}],postId:[{required:!0,message:"请选择所属岗位",trigger:"change"}],type:[{required:!0,message:"请选择用户类型",trigger:"change"}]});oe(l,o=>{o&&(V.password[0].required=o.title==="新增")},{immediate:!0,deep:!0});const s=R({allRolesList:[],assginRoleList:[],checkAll:!1,isIndeterminate:!1}),C=o=>{s.assginRoleList=o?s.allRolesList.map(e=>e.id):[],console.log(s.assginRoleList),s.isIndeterminate=!1},t=o=>{const e=o.length;s.checkAll=e===s.allRolesList.length,s.isIndeterminate=e>0&&e<s.allRolesList.length},i=o=>{if(D.value=JSON.parse(JSON.stringify(o.rowData)),o.title==="编辑"&&(o.rowData.password="",o.rowData.confirmPassword=""),o.title==="分配角色"){const{list:e}=o;s.allRolesList=e.data,s.assginRoleList=e==null?void 0:e.data.filter(n=>n.selected).map(n=>n.id),s.isIndeterminate=s.assginRoleList.length>0}l.value=o,w.value=!0},c=v(),h=()=>{c.value.validate(async o=>{if(console.log("valid",o),!!o)try{if(y.value=!0,l.value.title==="分配角色"){const e={userId:l.value.rowData.id,roleIdList:s.assginRoleList};await l.value.api(e)}else await l.value.api(l.value.rowData);x.success({message:`${l.value.title}用户成功！`}),l.value.getTableList(),w.value=!1,y.value=!1}catch(e){y.value=!1,console.log(e)}})};return _({acceptParams:i}),(o,e)=>{const n=m("el-input"),d=m("el-form-item"),O=m("el-option"),F=m("el-select"),j=m("el-radio"),H=m("el-radio-group"),I=m("el-checkbox"),z=m("el-checkbox-group"),J=m("el-form"),N=m("el-button"),K=m("el-drawer");return p(),f(K,{modelValue:w.value,"onUpdate:modelValue":e[10]||(e[10]=a=>w.value=a),"destroy-on-close":!0,size:"450px",title:`${l.value.title}用户`},{footer:r(()=>[u(N,{onClick:e[9]||(e[9]=a=>w.value=!1)},{default:r(()=>[b("取消")]),_:1}),u(N,{type:"primary",onClick:h,loading:y.value},{default:r(()=>[b(" 确定 ")]),_:1},8,["loading"])]),default:r(()=>[u(J,{ref_key:"ruleFormRef",ref:c,"label-width":"120px","label-suffix":" :",rules:V,model:l.value.rowData},{default:r(()=>[u(d,{label:"用户名",prop:"username"},{default:r(()=>[u(n,{disabled:l.value.title==="分配角色",modelValue:l.value.rowData.username,"onUpdate:modelValue":e[0]||(e[0]=a=>l.value.rowData.username=a),modelModifiers:{trim:!0},placeholder:"请填写用户姓名",clearable:""},null,8,["disabled","modelValue"])]),_:1}),l.value.title==="新增"||l.value.title==="编辑"?(p(),f(d,{key:0,label:l.value.title==="编辑"?"修改用户密码":"用户密码",prop:"password"},{default:r(()=>[u(n,{modelValue:l.value.rowData.password,"onUpdate:modelValue":e[1]||(e[1]=a=>l.value.rowData.password=a),modelModifiers:{trim:!0},placeholder:"请填写用户密码",clearable:""},null,8,["modelValue"])]),_:1},8,["label"])):g("",!0),l.value.title==="编辑"?(p(),f(d,{key:1,label:"确认密码",prop:"confirmPassword"},{default:r(()=>[u(n,{modelValue:l.value.rowData.confirmPassword,"onUpdate:modelValue":e[2]||(e[2]=a=>l.value.rowData.confirmPassword=a),modelModifiers:{trim:!0},placeholder:"请再次填写用户密码",clearable:""},null,8,["modelValue"])]),_:1})):g("",!0),l.value.title!=="分配角色"?(p(),f(d,{key:2,label:"用户昵称",prop:"name"},{default:r(()=>[u(n,{modelValue:l.value.rowData.name,"onUpdate:modelValue":e[3]||(e[3]=a=>l.value.rowData.name=a),modelModifiers:{trim:!0},placeholder:"请填写用户昵称",clearable:""},null,8,["modelValue"])]),_:1})):g("",!0),l.value.title!=="分配角色"?(p(),f(d,{key:3,label:"手机",prop:"phone"},{default:r(()=>[u(n,{modelValue:l.value.rowData.phone,"onUpdate:modelValue":e[4]||(e[4]=a=>l.value.rowData.phone=a),modelModifiers:{trim:!0},placeholder:"请填写用户手机",clearable:""},null,8,["modelValue"])]),_:1})):g("",!0),l.value.title!=="分配角色"?(p(),f(d,{key:4,label:"岗位",prop:"postId"},{default:r(()=>[u(F,{modelValue:l.value.rowData.postId,"onUpdate:modelValue":e[5]||(e[5]=a=>l.value.rowData.postId=a),placeholder:"请选择岗位",clearable:"",style:{width:"95%"}},{default:r(()=>[(p(!0),L(S,null,U(l.value.postList,a=>(p(),f(O,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):g("",!0),l.value.title!=="分配角色"?(p(),f(d,{key:5,label:"用户类型",prop:"type"},{default:r(()=>[u(H,{modelValue:l.value.rowData.type,"onUpdate:modelValue":e[6]||(e[6]=a=>l.value.rowData.type=a)},{default:r(()=>[(p(!0),L(S,null,U(M(q),a=>(p(),f(j,{label:a.value,key:a.value},{default:r(()=>[b(E(a.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})):g("",!0),l.value.title==="分配角色"?(p(),f(d,{key:6,label:"角色列表",prop:"rolesId"},{default:r(()=>[u(I,{modelValue:s.checkAll,"onUpdate:modelValue":e[7]||(e[7]=a=>s.checkAll=a),indeterminate:s.isIndeterminate,onChange:C},{default:r(()=>[b(" 全选 ")]),_:1},8,["modelValue","indeterminate"]),u(z,{modelValue:s.assginRoleList,"onUpdate:modelValue":e[8]||(e[8]=a=>s.assginRoleList=a),onChange:t},{default:r(()=>[(p(!0),L(S,null,U(s.allRolesList,a=>(p(),f(I,{key:a.id,label:a.id},{default:r(()=>[b(E(a.name),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})):g("",!0)]),_:1},8,["rules","model"])]),_:1},8,["modelValue","title"])}}});function ue(k){return typeof k=="function"||Object.prototype.toString.call(k)==="[object Object]"&&!se(k)}const fe=B({__name:"user",setup(k){const _=v(),D=R({}),w=t=>({list:t==null?void 0:t.records,total:t==null?void 0:t.total}),l=v(),y=async(t,i={})=>{var h;let c={title:t,rowData:{...i},api:t==="新增"?X:t==="编辑"?Y:Z,getTableList:(h=_.value)==null?void 0:h.getTableList,postList:V.value};console.log(c),l.value.acceptParams(c)},P=async t=>{var i;if((t==null?void 0:t.username)==="admin"){x({type:"warning",message:"系统用户不允许删除"});return}await A(ee,t.id,`删除${t.username}用户`),(i=_.value)==null||i.getTableList()},$=async t=>{var i,c;await A(ae,t,"删除所选用户信息"),(i=_.value)==null||i.clearSelection(),(c=_.value)==null||c.getTableList()},V=v([]),s=async()=>{try{const t=await le();V.value=t.data}catch(t){console.log(t),x.error((t==null?void 0:t.message)||"Has Error")}},C=[{type:"index",label:"序号"},{prop:"name",label:"员工姓名",search:{el:"input",props:{placeholder:"输入员工姓名"}}},{prop:"phone",label:"手机号码",search:{el:"input",props:{placeholder:"输入手机号码"}}},{prop:"postName",label:"岗位"},{prop:"type",label:"用户类型",render:({row:t})=>{let i;return u(m("el-tag"),{className:"flex-wrap m-r-10 m-t-5"},ue(i=G(q,t.type))?i:{default:()=>[i]})}},{prop:"status",label:"状态",width:100,render:({row:t})=>u(m("el-switch"),{"active-value":T.NORMAL,"inactive-value":T.DISABLED,modelValue:t.status,"onUpdate:modelValue":i=>t.status=i,onChange:()=>te(t.id,t.status)},null)},{prop:"operation",label:"操作",fixed:"right",width:280}];return re(()=>{s()}),(t,i)=>{const c=m("el-button"),h=m("ProTable");return p(),L("div",null,[u(h,{ref_key:"proTable",ref:_,dataCallback:w,columns:C,requestApi:M(W),initParam:D},{tableHeader:r(o=>[u(c,{type:"primary",icon:"Plus",onClick:i[0]||(i[0]=e=>y("新增"))},{default:r(()=>[b(" 添加 ")]),_:1}),g("",!0)]),operation:r(o=>[u(c,{type:"primary",link:"",icon:"Edit",onClick:e=>y("编辑",o.row)},{default:r(()=>[b(" 编辑 ")]),_:2},1032,["onClick"]),u(c,{type:"primary",link:"",icon:"Delete",onClick:e=>P(o.row)},{default:r(()=>[b(" 删除 ")]),_:2},1032,["onClick"])]),_:1},8,["requestApi","initParam"]),u(ne,{ref_key:"drawerRef",ref:l},null,512)])}}});export{fe as default};
